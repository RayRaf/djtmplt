# Copilot / AI Agent Instructions for This Project

## CRITICAL RULES — Docker Compose

1. **NEVER use `ports:` in `docker-compose.yml`** — production services must use `expose:` only. Dokploy/Traefik handles external routing via the Docker network.
2. **`ports:` go ONLY in `docker-compose.override.yml`** — this file is for local development and is auto-merged by Docker Compose.
3. **All services communicate via the `app-network` Docker network** — use service names as hostnames (e.g., `db`, `redis`, `web`).

## CRITICAL RULES — Environment Variables

4. **NEVER hardcode `ALLOWED_HOSTS`, `CORS_ALLOWED_ORIGINS`, `CSRF_TRUSTED_ORIGINS`, or `SECRET_KEY`** — always read from `os.environ`.
5. **Local dev uses `.env` file** (loaded via `env_file:` in `docker-compose.override.yml`).
6. **Production uses Dokploy Environment Settings** — no `.env` file in production.
7. **`DATABASE_URL` format**: `postgres://user:password@db:5432/dbname` — host is always `db` (the Docker service name).

## Settings Architecture

- `config/settings/base.py` — shared, env-driven settings
- `config/settings/dev.py` — local: DEBUG=True, CORS_ALLOW_ALL
- `config/settings/prod.py` — production: SSL, HSTS, secure cookies
- Switch via `DJANGO_SETTINGS_MODULE` env var

## Adding New Services

When adding a new service to docker-compose:
- In `docker-compose.yml`: use `expose:`, add to `app-network`, add healthcheck
- In `docker-compose.override.yml`: add `ports:` mapping for local access
- Never expose databases or caches to the host in production

## File Structure

- `/app/` — Django project root (contains `manage.py`)
- `/requirements/` — split into `base.txt`, `dev.txt`, `prod.txt`
- `/entrypoint.sh` — waits for DB, runs migrations, then starts CMD
